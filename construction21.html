<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Security: Content Security Policy replacing X-Frame-Options -->
    <meta http-equiv="Content-Security-Policy"
          content="default-src 'self' https://www.gstatic.com;
                   script-src 'self' https://cdn.tailwindcss.com https://www.gstatic.com;
                   frame-ancestors 'none';">
    <!-- Performance: Cache-Control hint -->
    <meta http-equiv="Cache-Control" content="public, max-age=31536000, immutable">
    <title>Construction 21</title>
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNlMGExMDYiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMTUuMDUgNWEzIDMgMCAwIDEgNC41IDBIM15NMTUuMDUgNU0xOSA4LjVjMCAxLjUtLjUgMy41LTIgNC41di4wNUgxN2EyIDIgMCAwIDAgLTIgLTIgYSAyIDIgMCAwIDAgLTIgMkgxM3YtNkgxNlY4LjVNOSA2LjVWNE02IDcgTDUuNSAxNC41TWwwIDE1IDguOTkgMy04IGMxLjUgLTRoMmMwIDAuNSAwLjUgMSAwLjUgMnYxSDEwdjNjMCAxIDAgMi40IC0xIDN2XzIgYzAgMC41IDAuMiAwLjUgMC41IDAuNXMwLjUgLTAuMiAwLjUgLTAuNVYyMUg0LjA3bDEuOCAtMTQuMjUgYTEgMSAwIDAgMSAwLjE5IC0wLjA3IHoiLz48L3N2Zz4=" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Your existing CSS styles unchanged */
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div class="animated-bg">
        <div class="bg-shape bg-shape1"></div>
        <div class="bg-shape bg-shape2"></div>
        <div class="bg-shape bg-shape3"></div>
    </div>

    <div id="game-container" class="p-4 mx-auto max-w-4xl">
        <h1 class="text-4xl font-bold text-center text-yellow-400 mb-4">ðŸ”¨ Construction 21 ðŸ”¨</h1>

        <!-- Main Menu -->
        <div id="main-menu" class="bg-gray-800 p-6 rounded-lg shadow-lg text-center">
            <div id="auth-section"></div>
            <div id="user-profile" class="hidden">
                <h3 class="text-2xl mb-2">
                    Welcome, <span id="profile-name" class="font-bold text-yellow-400"></span>!
                </h3>
                <div class="text-lg mb-4">
                    Your Chips: <span id="profile-chips" class="font-bold"></span>
                </div>
                <button id="play-btn" class="primary-btn bg-blue-600 hover:bg-blue-700 text-white w-full sm:w-auto">
                    Play Game
                </button>
                <button id="logout-btn" class="secondary-btn bg-gray-600 hover:bg-gray-700 text-white w-full sm:w-auto mt-2 sm:mt-0 sm:ml-2">
                    Logout
                </button>
            </div>
        </div>

        <!-- Game Canvas -->
        <div id="game-canvas" class="hidden mt-4">
            <div class="card-table">
                <!-- Result Screen -->
                <div id="game-result-screen">
                    <div id="result-message" class="text-2xl font-bold text-center p-4"></div>
                    <div class="text-2xl">
                        Final Chips: <span id="final-chips" class="font-bold">0</span>
                    </div>
                    <div>
                        <button id="play-again-btn" class="primary-btn bg-blue-600 hover:bg-blue-700 text-white">
                            Play Again
                        </button>
                        <button id="return-menu-btn" class="secondary-btn bg-gray-600 hover:bg-gray-700 text-white ml-2">
                            Main Menu
                        </button>
                    </div>
                </div>

                <div class="dealer-area">
                    <div class="hand-label">
                        Dealer's Hand: <span id="dealer-score">0</span>
                    </div>
                    <div id="dealer-cards" class="cards"></div>
                </div>

                <div id="side-bet-results" class="hidden text-center p-2 bg-gray-700 rounded-lg"></div>

                <div class="player-area">
                    <div class="hand-label">Your Hand(s)</div>
                    <div id="player-hands-display" class="flex flex-wrap justify-center gap-4 w-full"></div>
                </div>

                <div id="betting-controls" class="mt-4 p-4 bg-gray-800 rounded-lg flex flex-col items-center gap-3">
                    <h3 class="text-lg font-semibold">Place Your Bets</h3>
                    <div class="flex flex-wrap justify-center items-center gap-4">
                        <div class="flex items-center space-x-2">
                            <label for="bet-amount" class="text-sm font-bold">Main Bet:</label>
                            <input type="number" id="bet-amount" value="10" min="1"
                                   class="p-1 border rounded w-24 text-black text-center">
                        </div>
                        <div class="flex items-center space-x-2">
                            <label for="perfect-pairs-bet" class="text-sm">Perfect Pairs:</label>
                            <input type="number" id="perfect-pairs-bet" value="0" min="0"
                                   class="p-1 border rounded w-20 text-black text-center">
                        </div>
                        <div class="flex items-center space-x-2">
                            <label for="twenty-one-plus-three-bet" class="text-sm">21+3:</label>
                            <input type="number" id="twenty-one-plus-three-bet" value="0" min="0"
                                   class="p-1 border rounded w-20 text-black text-center">
                        </div>
                    </div>
                    <button id="place-bet-btn"
                            class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg">
                        Place Bet
                    </button>
                </div>

                <div id="game-controls" class="mt-4 space-x-2 hidden flex justify-center">
                    <button id="hit-btn" class="control-btn bg-blue-600 hover:bg-blue-700 text-white">Hit</button>
                    <button id="stand-btn" class="control-btn bg-yellow-500 hover:bg-yellow-600 text-black">Stand</button>
                    <button id="double-down-btn" class="control-btn bg-green-500 hover:bg-green-600 text-white">
                        Double Down
                    </button>
                    <button id="split-btn" class="control-btn bg-purple-500 hover:bg-purple-600 text-white">Split</button>
                </div>
            </div>
        </div>

        <!-- Leaderboard -->
        <div id="leaderboard" class="mt-6 p-4 rounded-lg shadow-lg hidden">
            <h2 class="text-2xl font-bold text-center mb-4 text-yellow-400">Top Players</h2>
            <ul id="leaderboard-entries" class="space-y-2"></ul>
        </div>
    </div>

    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, signInWithEmailAndPassword }
          from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc }
          from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // DOM
        const authSection = document.getElementById('auth-section');
        const userProfile = document.getElementById('user-profile');
        let auth, db;

        function initializeFirebase() {
            const firebaseConfig = {
                apiKey: "AIzaSyBVtq6dAEuybJNmTTv8dXBxTVUgw1t0ZMk",
                authDomain: "cusumano-website.firebaseapp.com",
                projectId: "cusumano-website",
            };
            initializeApp(firebaseConfig);
            auth = getAuth();
            db = getFirestore();

            onAuthStateChanged(auth, user => {
                if (user) showUserProfile(user);
                else showAuthForms();
            });
        }

        function showAuthForms() {
            authSection.innerHTML = `
                <div class="space-y-4">
                    <input id="login-email" type="email" placeholder="Email" class="w-full p-2 rounded bg-gray-700">
                    <input id="login-password" type="password" placeholder="Password" class="w-full p-2 rounded bg-gray-700">
                    <button id="login-btn" class="w-full py-2 bg-indigo-600 rounded">Login</button>
                    <p id="login-message" class="text-red-400"></p>
                </div>`;
            document.getElementById('login-btn').addEventListener('click', handleLogin);
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const pwd = document.getElementById('login-password').value;
            const msg = document.getElementById('login-message');
            msg.textContent = 'Logging inâ€¦';
            console.log('Attempt login', email);
            try {
                const cred = await signInWithEmailAndPassword(auth, email, pwd);
                console.log('Success', cred.user);
            } catch (err) {
                console.error('Login error', err);
                msg.textContent = err.message;
            }
        }

        function showUserProfile(user) {
            authSection.classList.add('hidden');
            userProfile.classList.remove('hidden');
            document.getElementById('profile-name').textContent = user.displayName || user.email;
            document.getElementById('logout-btn').addEventListener('click', () => signOut(auth));
        }

        document.addEventListener('DOMContentLoaded', initializeFirebase);
    </script>
</body>
</html>
